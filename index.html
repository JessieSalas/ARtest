<!DOCTYPE html>
<html>
<head>
    <!-- Include A-Frame and other required libraries -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
</head>
<body style='margin: 0; overflow: hidden;'>

<a-scene embedded arjs='sourceType: webcam;'>
    <!-- Assets to define external content -->
    <a-assets>
        <img id="d3-image" crossorigin="anonymous">
    </a-assets>

    <!-- Marker to define what we track -->
    <a-marker preset="hiro">
        <!-- Using the image as a texture for the plane -->
        <a-plane position="0 0 0" rotation="-90 0 0" width="1" height="1" material="src: #d3-image;"></a-plane>
    </a-marker>

    <!-- Defining the camera for AR -->
    <a-entity camera></a-entity>
</a-scene>

<!-- Invisible iframe for the D3 content -->
<iframe id="d3-iframe" style="display:none;" src="visualization.html"></iframe>

<!-- UI for user controls -->
<div id="controls">
    <!-- Add your desired controls here -->
</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Get the iframe and image elements
        var iframe = document.getElementById('d3-iframe');
        var d3Image = document.getElementById('d3-image');

        // Listen for the 'render' message from the visualization
        window.addEventListener('message', function(event) {
            if (event.data.type === 'render') {
                // When received, update the A-Frame texture directly
                d3Image.setAttribute('src', event.data.dataUrl);
            }
        });

        // TODO: Add event listeners for user controls, which will post messages to the iframe
    });
</script>

</body>
</html>
