<!DOCTYPE html>
<html>
<head>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        #controls {
            position: fixed;
            bottom: 10px;
            left: 10px;
            z-index: 999;
        }
        button {
            margin-top: 5px;
        }
    </style>
</head>
<body style='margin : 0; overflow: hidden;'>

<a-scene embedded arjs='sourceType: webcam;'>
    <a-assets>
        <img id="d3-image" crossorigin="anonymous">
    </a-assets>

    <a-marker preset="hiro">
        <a-plane position="0 0 0" rotation="-90 0 0" width="1" height="1" material="src: #d3-image;"></a-plane>
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<iframe id="d3-iframe" style="display:none;" src="visualization.html"></iframe>

<div id="controls">
    <!-- Buttons to change the color of the circles -->
    <button onclick="updateCircles('color', 'red')">Red</button>
    <button onclick="updateCircles('color', 'green')">Green</button>
    <button onclick="updateCircles('color', 'blue')">Blue</button>
    
    <!-- Buttons to change the size of the circles -->
    <button onclick="updateCircles('size', 'small')">Small</button>
    <button onclick="updateCircles('size', 'medium')">Medium</button>
    <button onclick="updateCircles('size', 'large')">Large</button>

    <!-- Buttons to change the number of circles -->
    <button onclick="updateCircles('number', 1)">One Circle</button>
    <button onclick="updateCircles('number', 2)">Two Circles</button>
    <button onclick="updateCircles('number', 3)">Three Circles</button>
</div>

<script>
    var iframe = document.getElementById('d3-iframe');
    var d3Image = document.getElementById('d3-image');
    var circleProperties = [{x: 150, y: 150, radius: 50, color: 'green'}]; // Default properties

    // Function to update the circles based on user input
    function updateCircles(property, value) {
        if (property === 'color') {
            circleProperties.forEach(function(circle) {
                circle.color = value;
            });
        } else if (property === 'size') {
            var sizes = { small: 30, medium: 50, large: 70 };
            circleProperties.forEach(function(circle) {
                circle.radius = sizes[value];
            });
        } else if (property === 'number') {
            circleProperties = []; // Reset the array
            for (var i = 0; i < value; i++) {
                // Add circles with default or previous properties
                circleProperties.push({x: 100 + (i * 50), y: 150, radius: 50, color: 'green'});
            }
        }

        // Send the updated properties to the iframe to redraw
        iframe.contentWindow.postMessage({
            type: 'updateVisualization',
            circleProperties: circleProperties
        }, '*');
    }

    // Listen for the 'render' message from the visualization
    window.addEventListener('message', function(event) {
        if (event.data.type === 'render') {
            d3Image.setAttribute('src', event.data.dataUrl);
        }
    });
</script>

</body>
</html>
