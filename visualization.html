<!DOCTYPE html>
<html>
<head>
    <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

<canvas id="d3-canvas" width="300" height="300"></canvas>

<script>
    var canvas = document.getElementById('d3-canvas');
    var context = canvas.getContext('2d');

    // Function to draw one or multiple circles
    function drawCircles(circleProperties) {
        // Clear the canvas before drawing the next frame
        context.clearRect(0, 0, canvas.width, canvas.height);

        circleProperties.forEach(function(circle) {
            context.beginPath();
            context.arc(circle.x, circle.y, circle.radius, 0, 2 * Math.PI, false);
            context.fillStyle = circle.color;
            context.fill();
        });

        // Send the rendered image back to the main document
        var dataUrl = canvas.toDataURL("image/png");
        window.parent.postMessage({ type: 'render', dataUrl: dataUrl }, '*');
    }

    // Default drawing
    drawCircles([{x: 150, y: 150, radius: 50, color: 'green'}]);

    // Listen for messages to redraw with new properties
    window.addEventListener('message', function(event) {
        if (event.data.type === 'updateVisualization') {
            drawCircles(event.data.circleProperties);
        }
    });
</script>

</body>
</html>
